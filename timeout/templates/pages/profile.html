{% extends 'base.html' %}
{% load static %}

{% block title %}
  My Profile - Timeout
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/profile.css' %}" />
{% endblock %}

{% block content %}
  <div class="container mt-4">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <!-- Profile Header -->
        <div class="card mb-4">
          <div class="card-body">
            <div class="d-flex align-items-center gap-3">
              <!-- Profile picture -->
              <div>
                {% if user.profile_picture %}
                  <img src="{{ user.profile_picture.url }}" alt="Profile picture" class="profile-avatar" />
                {% else %}
                  <div class="profile-avatar profile-avatar-fallback">{{ user.username|first|upper }}</div>
                {% endif %}
              </div>
              <div>
                <h3 class="m-0">@{{ user.username }}</h3>
                <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2 gap-md-3">
                  {% if user.get_full_name %}
                    <p class="text-muted mb-0">{{ user.get_full_name }}</p>
                  {% endif %}

                  <div class="text-muted small">
                    {% if user.university %}
                      <span>ğŸ“ {{ user.university }}</span>
                    {% endif %}
                    {% if user.year_of_study %}
                      <span class="ms-0 ms-md-2">Year {{ user.year_of_study }}</span>
                    {% endif %}
                  </div>
                </div>
                {% if user.bio %}
                  <p class="my-2">{{ user.bio }}</p>
                {% endif %}
                <div class="mt-3">
                  <span class="badge bg-light text-dark me-2">{{ posts|length }} Posts</span>
                  <span class="badge bg-light text-dark me-2">{{ user.follower_count }} Followers</span>
                  <span class="badge bg-light text-dark">{{ user.following_count }} Following</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Status Setter -->
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">My Status</h5>
            <p class="text-muted small mb-3">
              Current: <strong id="current-status-display">{{ user.get_status_display }}</strong>
            </p>
            <div class="d-flex gap-2 flex-wrap">
              {% for value, label in status_choices %}
                <button class="btn status-btn {% if user.status == value %}
                    
                    
                    btn-primary


                  {% else %}
                    
                    
                    btn-outline-secondary


                  {% endif %}"
                  data-status="{{ value }}">
                  {{ label }}
                </button>
              {% endfor %}
            </div>
          </div>
        </div>
        <!-- Schedule -->
        <div class="post-card mb-4">
          <div class="post-card-body">
            <div class="post-header">
              <div>
                <h4 class="m-0">Schedule</h4>
              </div>
            </div>
            {% if event %}
              <div class="schedule-row">
                <div class="schedule-status-bar bar-{{ event_status }}"></div>
                <div class="schedule-content">
                  <div class="d-flex align-items-center gap-2 mb-2">
                    {% if event_status == 'active' %}
                      <span class="schedule-badge badge-active">ğŸŸ¢ In Progress</span>
                    {% elif event_status == 'upcoming' %}
                      <span class="schedule-badge badge-upcoming">ğŸ”µ Up Next</span>
                    {% else %}
                      <span class="schedule-badge badge-recent">âšª Just Ended</span>
                    {% endif %}
                    <span class="cal-chip cal-chip--{{ event.event_type }}">{{ event.get_event_type_display }}</span>
                  </div>

                  <p class="post-content mb-1">{{ event.title }}</p>

                  {% if event.is_all_day %}
                    <p class="post-time">ğŸ“… All Day</p>
                  {% else %}
                    <p class="post-time">ğŸ• {{ event.start_datetime|date:'H:i' }} â€“ {{ event.end_datetime|date:'H:i' }}</p>
                  {% endif %}

                  {% if event.location %}
                    <p class="post-time">ğŸ“ {{ event.location }}</p>
                  {% endif %}

                  {% if event.description %}
                    <p class="post-time">ğŸ’¬ {{ event.description|truncatechars:50 }}</p>
                  {% endif %}
                </div>
              </div>
            {% else %}
              <p class="post-content" style="color: var(--to-muted);">No upcoming schedule</p>
            {% endif %}
          </div>
        </div>

        <!-- My Posts -->
        <h4 class="mb-3">My Posts</h4>
        {% if posts %}
          {% for post in posts %}
            {% include 'social/_post_card.html' with post=post %}
          {% endfor %}
        {% else %}
          <div class="alert alert-info">You haven't posted anything yet.</div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/social.js' %}"></script>
  <div id="profile-status-config" data-update-url="{% url 'update_status' %}" data-csrf-token="{{ csrf_token }}"></div>
  <script src="{% static 'js/profile.js' %}"></script>
{% endblock %}
