{% extends 'base.html' %}
{% load static %}

{% block title %}Social Feed - Timeout{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/social.css' %}">
{% endblock %}

{% block content %}
<div class="feed-wrapper">
  <div class="row g-4">

    <!-- ‚îÄ‚îÄ Left: Feed ‚îÄ‚îÄ -->
    <div class="col-lg-8">

      <!-- Create Post -->
      <div class="glass-card create-post-card">
        <div class="card-label">‚úèÔ∏è Create Post</div>
        <form method="post" action="{% url 'create_post' %}">
          {% csrf_token %}
          {{ post_form.content }}
          <div class="post-selects">
            <div>{{ post_form.event }}</div>
            <div>{{ post_form.privacy }}</div>
          </div>
          <div class="post-footer">
            <button type="submit" class="btn-post">Post</button>
          </div>
        </form>
      </div>

      <!-- Feed Tabs -->
      <div class="feed-tabs">
        <a href="?tab=following"
           class="feed-tab {% if active_tab == 'following' %}active{% endif %}">
          Following
        </a>
        <a href="?tab=discover"
           class="feed-tab {% if active_tab == 'discover' %}active{% endif %}">
          Discover
        </a>
        <a href="{% url 'bookmarks' %}" class="feed-tab">
          Bookmarks
        </a>
      </div>

      <!-- Posts -->
      {% if posts %}
        {% for post in posts %}
          {% include 'social/_post_card.html' with post=post %}
        {% endfor %}
      {% else %}
        <div class="empty-state">
          <div class="icon">üå±</div>
          {% if active_tab == 'following' %}
            No posts yet ‚Äî follow some people to see their posts here!
          {% else %}
            Nothing to discover yet. Check back soon!
          {% endif %}
        </div>
      {% endif %}

    </div>

    <!-- ‚îÄ‚îÄ Right: Messaging Sidebar ‚îÄ‚îÄ -->
    <div class="col-lg-4">
      <div class="messages-sidebar">
        <div class="glass-card">
          <div class="messages-header">
            <h6>üí¨ Messages</h6>
            <a href="{% url 'inbox' %}" class="btn-see-all">See All</a>
          </div>
          <div>
            {% if conversation_data %}
              {% for item in conversation_data %}
                <a href="{% url 'conversation' item.conv.id %}" class="msg-row">
                  <div class="msg-avatar">{{ item.other.username|first|upper }}</div>
                  <div class="msg-info">
                    <div class="msg-name-row">
                      <span class="msg-name">{{ item.other.username }}</span>
                      <span class="status-dot status-{{ item.other.status }}"></span>
                    </div>
                    <div class="msg-preview">
                      {% if item.last %}{{ item.last.content|truncatechars:38 }}{% else %}No messages yet{% endif %}
                    </div>
                  </div>
                </a>
              {% endfor %}
            {% else %}
              <div class="msg-empty">
                <div class="icon">üíå</div>
                No conversations yet.<br>Visit a profile to start one!
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/social.js' %}"></script>
{% endblock %}