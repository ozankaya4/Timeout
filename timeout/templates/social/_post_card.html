<div class="post-card">
  <div class="post-card-body">

    <!-- Header -->
    <div class="post-header">
      <div>
        <a href="{% url 'user_profile' post.author.username %}" class="post-author-link">
          {{ post.author.username }}
        </a>
        <div class="post-meta">
          <span class="post-time">{{ post.created_at|timesince }} ago</span>
          {% if post.privacy == 'followers_only' %}
            <span class="badge-followers">Followers Only</span>
          {% endif %}
        </div>
      </div>
      {% if post.author == user or user.is_staff %}
        <form method="post" action="{% url 'delete_post' post.id %}"
              onsubmit="return confirm('Delete this post?');" style="margin:0;">
          {% csrf_token %}
          <button type="submit" class="btn-delete-post">Delete</button>
        </form>
      {% endif %}
    </div>

    <!-- Content -->
    <p class="post-content">{{ post.content }}</p>

    <!-- Linked Event -->
    {% if post.event %}
      <div class="post-event-tag">
        ğŸ“…
        <div>
          <div>{{ post.event.title }}</div>
          <div class="event-date">{{ post.event.start_datetime|date:"F j, Y g:i A" }}</div>
        </div>
      </div>
    {% endif %}

    <!-- Divider + Actions -->
    <div class="post-divider"></div>
    <div class="post-actions">
      <button class="action-btn action-btn-like like-btn"
              data-post-id="{{ post.id }}"
              data-liked="false">
        <span class="like-icon">ğŸ¤</span>
        <span class="like-count">{{ post.likes.count }}</span> Likes
      </button>

      <button class="action-btn action-btn-comment"
              data-bs-toggle="collapse"
              data-bs-target="#comments-{{ post.id }}">
        ğŸ’¬ {{ post.comments.count }} Comments
      </button>

      <button class="action-btn action-btn-bookmark bookmark-btn"
              data-post-id="{{ post.id }}"
              data-bookmarked="false">
        <span class="bookmark-icon">ğŸ·ï¸</span>
        Bookmark
      </button>
    </div>

    <!-- Comments (Collapsed) -->
    <div class="collapse" id="comments-{{ post.id }}">
      <div class="comments-section">
        <form method="post" action="{% url 'add_comment' post.id %}" class="comment-form">
          {% csrf_token %}
          <textarea name="content" rows="2" placeholder="Write a commentâ€¦" required></textarea>
          <button type="submit" class="btn-comment-submit">Post</button>
        </form>

        {% for comment in post.comments.all %}
          <div class="comment-item {% if comment.parent %}reply{% endif %}">
            <div class="comment-avatar">{{ comment.author.username|first|upper }}</div>
            <div class="comment-bubble">
              <a href="{% url 'user_profile' comment.author.username %}" class="comment-author">
                {{ comment.author.username }}
              </a>
              <span class="comment-time">{{ comment.created_at|timesince }} ago</span>
              <div class="comment-text">{{ comment.content }}</div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

  </div>
</div>